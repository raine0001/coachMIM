{% extends "base.html" %}
{% block content %}
  <style>
    .home-quick-links {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .home-quick-link {
      text-decoration: none;
      border: 1px solid var(--line);
      border-radius: 8px;
      padding: 8px 12px;
      background: #fff;
      color: var(--text);
      font-weight: 600;
    }
  </style>

  <div class="card">
    <h1>CoachMIM</h1>
    <p>{{ public_content.home_intro }}</p>
    <p class="muted">Phase I focuses on clean baseline capture for 30-60 days.</p>
  </div>

  {% if is_authenticated %}
    <div class="card">
      <h2>Welcome back, {{ current_user.full_name or "CoachMIM user" }}</h2>
      {% if missing_required %}
        <p class="muted">
          Core profile fields still missing:
          {{ missing_required | join(", ") }}.
        </p>
        <p><a href="{{ url_for('main.profile') }}">Complete profile setup</a></p>
      {% else %}
        <p class="muted">Profile baseline complete. Continue daily logging.</p>
      {% endif %}
    </div>

    <div class="grid">
      <div class="card">
        <h3>Check-Ins Logged</h3>
        <div class="metric">{{ checkin_count }}</div>
      </div>
      <div class="card">
        <h3>Meals Logged</h3>
        <div class="metric">{{ meal_count }}</div>
      </div>
      <div class="card">
        <h3>Substances Logged</h3>
        <div class="metric">{{ substance_count }}</div>
      </div>
    </div>

    <div class="card">
      <h2>Weekly Snapshot</h2>
      <p class="muted">
        {{ weekly.week_start.strftime("%b %d") }} - {{ weekly.week_end.strftime("%b %d, %Y") }}
      </p>
      <div class="grid">
        <div>
          <div class="muted">Workout Time This Week</div>
          <div class="metric">{{ weekly.workout_minutes }} min</div>
          <div class="muted">{{ weekly.workout_sessions }} session{{ "" if weekly.workout_sessions == 1 else "s" }}</div>
        </div>
        <div>
          <div class="muted">Avg Calories / Logged Day</div>
          <div class="metric">{{ weekly.avg_calories_per_logged_day if weekly.avg_calories_per_logged_day is not none else "n/a" }}</div>
          <div class="muted">{{ weekly.total_calories_week }} total this week</div>
        </div>
        <div>
          <div class="muted">Check-In Coverage</div>
          <div class="metric">{{ weekly.coverage_pct }}%</div>
          <div class="muted">{{ weekly.checkins_logged_week }} of 7 days</div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>Average Metrics (7d)</h2>
      <div class="grid">
        <div>
          <div class="muted">Sleep Hours</div>
          <div class="metric">{{ weekly.avg_sleep if weekly.avg_sleep is not none else "n/a" }}</div>
        </div>
        <div>
          <div class="muted">Energy (1-10)</div>
          <div class="metric">{{ weekly.avg_energy if weekly.avg_energy is not none else "n/a" }}</div>
        </div>
        <div>
          <div class="muted">Focus (1-10)</div>
          <div class="metric">{{ weekly.avg_focus if weekly.avg_focus is not none else "n/a" }}</div>
        </div>
        <div>
          <div class="muted">Mood (1-10)</div>
          <div class="metric">{{ weekly.avg_mood if weekly.avg_mood is not none else "n/a" }}</div>
        </div>
        <div>
          <div class="muted">Stress (1-10)</div>
          <div class="metric">{{ weekly.avg_stress if weekly.avg_stress is not none else "n/a" }}</div>
        </div>
        <div>
          <div class="muted">Productivity (1-10)</div>
          <div class="metric">{{ weekly.avg_productivity if weekly.avg_productivity is not none else "n/a" }}</div>
        </div>
        <div>
          <div class="muted">Anxiety (1-10)</div>
          <div class="metric">{{ weekly.avg_anxiety if weekly.avg_anxiety is not none else "n/a" }}</div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>MIM Weekly Summary</h2>
      <p class="muted">Primary goal: {{ weekly.primary_goal }}</p>
      <ul style="margin-top: 0;">
        {% for note in weekly.mim_notes %}
          <li>{{ note }}</li>
        {% endfor %}
      </ul>
    </div>

    <div class="card">
      <h2>More Views</h2>
      <div class="home-quick-links">
        <a class="home-quick-link" href="{{ url_for('main.timeline') }}">Timeline</a>
        <a class="home-quick-link" href="{{ url_for('main.insights') }}">Weekly Insights</a>
      </div>
    </div>
  {% else %}
    <div class="card">
      <h2>Start Here</h2>
      <ol>
        <li>Create an account.</li>
        <li>Complete your core profile baseline.</li>
        <li>Begin daily check-ins and meal logging.</li>
      </ol>
      <p>
        <a href="{{ url_for('main.register') }}">Create account</a>
        or
        <a href="{{ url_for('main.login') }}">log in</a>.
      </p>
    </div>
  {% endif %}

  <div class="card">
    <h2>Support & Policies</h2>
    <p class="muted">
      Contact for help:
      <a href="mailto:{{ public_content.contact_email }}">{{ public_content.contact_email }}</a>
    </p>
    <div class="home-quick-links">
      <a class="home-quick-link" href="{{ url_for('main.privacy_page') }}">Privacy Policy</a>
      <a class="home-quick-link" href="{{ url_for('main.terms_page') }}">Terms</a>
    </div>
  </div>
{% endblock %}
